<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libm2k: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libm2k
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">libm2k Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#license">License</a></li>
<li class="level1"><a href="#architecture">Architecture</a><ul><li class="level2"><a href="#class-diagram">Class Diagram</a></li>
<li class="level2"><a href="#package-diagram">Top Level Diagram</a></li>
<li class="level2"><a href="#libm2k-m2k-open">M2K Open Sequence Diagram</a></li>
<li class="level2"><a href="#libm2k-async-acq">Asynchronous Acquisition Sequence Diagram</a></li>
<li class="level2"><a href="#libm2k-sync-acq">Synchronous Acquisition Sequence Diagram</a></li>
</ul>
</li>
<li class="level1"><a href="#python">Python Bindings</a></li>
<li class="level1"><a href="#example">Example</a></li>
<li class="level1"><a href="#faq">FAQ</a><ul><li class="level2"><a href="#faq-data-conversion">How can I acquire raw data fast and convert it to the corresponding value in Volts (in Python)?</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><img src="img/libm2k_logo.png" alt="libm2k_logo" width="1000" class="inline"/>
<h1><a class="anchor" id="license"></a>
License</h1>
<p>libm2k is licensed under the GNU Lesser General Public License v2.1</p>
<h1><a class="anchor" id="architecture"></a>
Architecture</h1>
<p>libm2k is a C++ library for interfacing with the ADALM2000, splitted into more correlated components, interconnected by a context. These M2K components represent the functionalities of ADALM2000:</p>
<ul>
<li><b>AnalogIn</b> - oscilloscope or voltmeter <br />
</li>
<li><b>AnalogOut</b> - signal generator <br />
</li>
<li><b>Digital</b> - logic analyzer or pattern generator <br />
</li>
<li><b>PowerSupply</b> - constant voltage generator <br />
</li>
<li><b>DMM</b> - digital multimeter <br />
</li>
</ul>
<h2><a class="anchor" id="class-diagram"></a>
Class Diagram</h2>
<p>The class diagram containing details for all public classes of libm2k.</p>
<img src="img/libm2k_class_diagram.png" alt="libm2k Class Diagram" class="inline"/>
<h2><a class="anchor" id="package-diagram"></a>
Top Level Diagram</h2>
<p>The top level diagram provides an overview for the library structure. The components are organized in their corresponding namespaces.</p>
<img src="img/libm2k_top_level.png" alt="libm2k Top Level Diagram" class="inline"/>
<h2><a class="anchor" id="libm2k-m2k-open"></a>
M2K Open Sequence Diagram</h2>
<p>In this diagram the necessary steps to create an M2K context and get a specific device are presented. <img src="img/libm2k_m2k_open.png" alt="libm2k M2K Open Sequence Diagram" class="inline"/>
<h2><a class="anchor" id="libm2k-async-acq"></a>
Asynchronous Acquisition Sequence Diagram</h2>
<p>The sequence diagram shows an example to the asynchronous acquisition flow for Analog In or Digital In. Running "startAcquisition(number_of_samples)" will create, initialize and populate the available kernel buffers with data. Everytime we call "getSamples", we retrieve data from those kernel buffers, which will automatically be refilled. <img src="img/libm2k_async_acq.png" alt="libm2k Asynchronous Acquisition Sequence Diagram" class="inline"/>
<h2><a class="anchor" id="libm2k-sync-acq"></a>
Synchronous Acquisition Sequence Diagram</h2>
<p>The sequence diagram shows an example to the synchronous acquisition flow for Analog In or Digital In. Running "getSamples(number_of_samples)" will create and initialize, but it will also populate all the available kernel buffers with data and it will return one buffer to the user. <img src="img/libm2k_sync_acq.png" alt="libm2k Synchronous Acquisition Sequence Diagram" class="inline"/>
<h1><a class="anchor" id="python"></a>
Python Bindings</h1>
<img src="img/libm2k-python_logo.png" alt="libm2k-python_logo" width="1000" class="inline"/>
<p>In order to use libm2k in Python applications please check the <a href="python/html/sphinx/build/html/index.html" title="libm2k Python Bindings API Sphinx">libm2k Python Bindings API</a></p>
<h1><a class="anchor" id="example"></a>
Example</h1>
<p>The following code shows a simple example on how to use libm2k together with the digital side of ADALM2000.</p>
<p>There are multiple examples provided for libm2k and can be found on the Github <a href="https://github.com/analogdevicesinc/libm2k/tree/main/examples" title="libm2k official Github page">libm2k examples</a> page. The examples are created to ease the work for a libm2k user. To get familiar with libm2k API, the examples can be modified and built out of the libm2k source code tree by keeping the CMake configuration file provided for each example.</p>
<div class="fragment"><div class="line"><span class="comment">// This example will generate a binary counter on the first N_BITS of the</span></div><div class="line"><span class="comment">// digital interface and read them back - no additional connection required</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;libm2k/m2k.hpp&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;libm2k/context.hpp&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;libm2k/contextbuilder.hpp&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;libm2k/digital/m2kdigital.hpp&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;bitset&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">using namespace </span>std;</div><div class="line"><span class="keyword">using namespace </span>libm2k;</div><div class="line"><span class="keyword">using namespace </span>libm2k::digital;</div><div class="line"><span class="keyword">using namespace </span>libm2k::context;</div><div class="line"></div><div class="line"><span class="preprocessor">#define N_BITS (4)</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main()</div><div class="line"></div><div class="line">{</div><div class="line">    <a class="code" href="classlibm2k_1_1context_1_1_context.html">Context</a> *c = contextOpen();</div><div class="line">    <span class="keywordflow">if</span> (!c) {</div><div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;Connection Error: No ADALM2000 device available/connected to your PC.&quot;</span> &lt;&lt; std::endl;</div><div class="line">        <span class="keywordflow">return</span> 1;</div><div class="line">    }</div><div class="line"></div><div class="line">    <a class="code" href="classlibm2k_1_1context_1_1_m2k.html">M2k</a>* ctx = c-&gt;<a class="code" href="group__context.html#gaf52f55ba6c313dc35a7ef24526887dce">toM2k</a>();</div><div class="line"></div><div class="line">    <a class="code" href="classlibm2k_1_1digital_1_1_m2k_digital.html">M2kDigital</a> *dig = ctx-&gt;<a class="code" href="group__m2k.html#ga1490bea0b084d2a0c1520fccedd37b01">getDigital</a>();</div><div class="line"></div><div class="line">    dig-&gt;<a class="code" href="group__digital.html#ga967d502aebe2cbd7ff5c3f9a1888c5ab">setSampleRateIn</a>(100000);</div><div class="line">    dig-&gt;<a class="code" href="group__digital.html#gad412f0742a9d5679050ffab2976f1f3d">setSampleRateOut</a>(100000);</div><div class="line"></div><div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;N_BITS;i++)</div><div class="line">    {</div><div class="line">        dig-&gt;<a class="code" href="group__digital.html#ga8a8c8b62cd3d0d1d31ea03b8f53c8cc6">setDirection</a>(i, DIO_OUTPUT);</div><div class="line">        dig-&gt;<a class="code" href="group__digital.html#ga43566daefbf55586beb4b29bea00999e">enableChannel</a>(i, <span class="keyword">true</span>);</div><div class="line">    }</div><div class="line"></div><div class="line">    vector&lt;unsigned short&gt; bufferOut;</div><div class="line">    vector&lt;unsigned short&gt; bufferIn;</div><div class="line"></div><div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt; (1&lt;&lt;N_BITS); i++)</div><div class="line">    {</div><div class="line">        bufferOut.push_back(i);</div><div class="line">    }</div><div class="line">    dig-&gt;<a class="code" href="group__digital.html#ga7a3eed27a67559a0bee079bb90e7ebf9">setCyclic</a>(<span class="keyword">true</span>);</div><div class="line">    dig-&gt;<a class="code" href="group__digital.html#ga4b46cea8636d88c3c3cc5e74f9a49d65">push</a>(bufferOut);</div><div class="line"></div><div class="line">    bufferIn = dig-&gt;<a class="code" href="group__digital.html#gad162531b93bfc8c7f8b8aeb49893e2eb">getSamples</a>(1000);</div><div class="line">    <span class="keywordflow">for</span>(<span class="keyword">auto</span> val : bufferIn)</div><div class="line">    {</div><div class="line">        cout&lt;&lt;bitset&lt;16&gt;(val)&lt;&lt;endl;</div><div class="line">    }</div><div class="line">    dig-&gt;<a class="code" href="group__digital.html#gab538cf207b486ccda152d5aa2bf17e31">stopBufferOut</a>();</div><div class="line">    <a class="code" href="group__contextbuilder.html#ga6e5e40d0e87d47f8ca103f5a0565eea8">contextClose</a>(ctx);</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><h1><a class="anchor" id="faq"></a>
FAQ</h1>
<p>Useful questions and answers for the libm2k API usage and ADALM2000 manipulation</p>
<h2><a class="anchor" id="faq-data-conversion"></a>
How can I acquire raw data fast and convert it to the corresponding value in Volts (in Python)?</h2>
<p>The Python bindings API are not a 100% mirror of the C++ code. Therefore, some methods might have a slightly different return type for Python (it is necessary to check the Python Bindings API Documentation listed above). For example, the getSamplesRawInterleaved() method will return <b>4*nb_samples</b> elements in the Python list. In order to make the acquisition faster, all the samples are returned in a bytes list. One sample for one channel (for AnalogIn) is represented using 2 bytes. The returned list of bytes will be <b>interleaved</b>, this meaning that it should be interpreted as one sample from CHANNEL_1, one sample from CHANNEL_2 and so on. One thing to keep in mind is that a sample corresponds to 2 elements in the list.</p>
<p>Let's take an example:</p>
<div class="fragment"><div class="line">samples = getSamplesRawInterleaved(10) </div><div class="line">samples.tolist()</div><div class="line"><span class="comment">#will return:</span></div><div class="line">[243, 255, 2, 0, 246, 255, 2, 0, 244, 255, 2, 0, 246, 255, 2, 0, 244, 255, 2, 0, 244, 255, 1, 0, 243, 255, 0, 0, 245, 255, 3, 0, 245, 255, 2, 0, 245, 255, 2, 0]</div><div class="line">samples.tobytes()</div><div class="line"><span class="comment">#will return:</span></div><div class="line">b<span class="stringliteral">&#39;\xf3\xff\x02\x00\xf6\xff\x02\x00\xf4\xff\x02\x00\xf6\xff\x02\x00\xf4\xff\x02\x00\xf4\xff\x01\x00\xf3\xff\x00\x00\xf5\xff\x03\x00\xf5\xff\x02\x00\xf5\xff\x02\x00&#39;</span></div><div class="line"><span class="comment">#[243, 255] corresponds to the first sample on CHANNEL_1</span></div><div class="line"><span class="comment">#[2, 0] corresponds to the first sample on CHANNEL_2</span></div></div><!-- fragment --><p>In order to convert all the samples you can use the following chunk of Python code:</p>
<div class="fragment"><div class="line"><span class="keyword">import</span> struct</div><div class="line"><span class="comment">#enable channels, acquire samples</span></div><div class="line">samples = samples.tobytes()</div><div class="line">count = int(len(samples)/2)</div><div class="line">value_list = struct.unpack(<span class="stringliteral">&#39;h&#39;</span>*count, samples)   <span class="comment">#&#39;h&#39; is the format for short</span></div><div class="line"><span class="comment">#value_list will be similar to the following: (-13, 2, -10, 2, -12, 2, -10, 2, -12, 2, -12, 1, -13, 0, -11, 3, -11, 2, -11, 2)</span></div></div><!-- fragment --><p>Next thing is to convert it into Volts. In Python, for AnalogIn() you have 2 exposed methods: <a class="el" href="group__analogin.html#gaba8667ff41c635f3328e437bf068b9a6" title="Convert the voltage value of a sample into raw.">libm2k::analog::M2kAnalogIn::convertVoltsToRaw(unsigned int channel, double voltage)</a> and <a class="el" href="group__analogin.html#ga237e94f6d8c7fc222bdd398ce8b8dd42" title="Convert the raw value of a sample into volts.">libm2k::analog::M2kAnalogIn::convertRawToVolts(unsigned int channel, short raw)</a>. Running convertRawToVolts(0, value_list[0]) should provide the needed Volts value for CHANNEL_1. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
